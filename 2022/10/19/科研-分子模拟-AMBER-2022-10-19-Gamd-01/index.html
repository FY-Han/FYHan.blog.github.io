<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="renderer" content="webkit">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
    <meta name="google-site-verification" content="TZE0rZyIqLl10trYu3BWBWa1Vmz6HFwhb2OcNEK4u-s" />
     <link rel="shortcut icon" href= /img/favicon.ico >
    <title>
        Hexo
    </title>
    <meta name="description" content= 嘿，我是刘训灼～这是我的子站，用于展示写的Hexo主题：Coder。欢迎访问！ >
    <meta name="keywords" content= Blog,Hexo,Theme,刘训灼,LiuXunzhuo >
    
<link rel="stylesheet" href="/libs/highlight/styles/monokai-sublime.css">

    
<link rel="stylesheet" href="/libs/font-awesome/css/font-awesome.min.css">

    
<link rel="stylesheet" href="/css/style.css">

<meta name="generator" content="Hexo 6.3.0"></head>
<body id="bodyx">
    <div class="hd posts">
    <a href="/index.html"><i class="fa fa-home
 replay-btn" aria-hidden="true"></i></a>
    <div class="post-title">
        <p>
            Gamd-01
        </p>
        <hr>
    </div>
    <div class="post-content">
        <h2 id="Gamd-tutorial"><a href="#Gamd-tutorial" class="headerlink" title="Gamd tutorial"></a>Gamd tutorial</h2><p>跑tutorial的时候碰到一个small box问题,不知道是不是amber22特有的</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">gpu_neighbor_list_setup :: Small box detected, with &lt;= 2 cells in one or more</span><br><span class="line">                           dimensions.  The current GPU code has been deemed</span><br><span class="line">                           unsafe for these situations.  Please alter the</span><br><span class="line">                           cutoff to increase the number of hash cells, make</span><br><span class="line">                           use of the CPU code, or (if absolutely necessary)</span><br><span class="line">                           run pmemd.cuda with the -AllowSmallBox flag.  This</span><br><span class="line">                           behavior will be corrected in a forthcoming patch.</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>因此需要额外加上一个flag</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="comment">#SBATCH --job-name=Gamd_004</span></span><br><span class="line"><span class="comment">#SBATCH --output=Gamd_004.out</span></span><br><span class="line"><span class="comment">#SBATCH --error=Gamd_004.err</span></span><br><span class="line"><span class="comment">#SBATCH --time=0-00:10:00    ## 1-00:00:00</span></span><br><span class="line"><span class="comment">#SBATCH --mail-user=feh34@pitt.edu</span></span><br><span class="line"><span class="comment">#SBATCH --mail-type=END,FAIL</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#SBATCH --nodes=1</span></span><br><span class="line"><span class="comment">#SBATCH --ntasks-per-node=1  ## 1 for gpu job; &lt;=24 for cpu job.</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#SBATCH --cluster=gpu        ## gpu, smp</span></span><br><span class="line"><span class="comment">#SBATCH --partition=a100  ## gtx1080, titanx, v100, a100; smp.</span></span><br><span class="line"><span class="comment">#SBATCH --qos=short          ##long (3~6days), normal (1-3days), short (&lt;1day)</span></span><br><span class="line"><span class="comment">#SBATCH --gres=gpu:4         ## only for GPU jobs.</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Load Modules</span></span><br><span class="line">module purge</span><br><span class="line">module load gcc/8.2.0 openmpi/4.0.3</span><br><span class="line">module load amber/22</span><br><span class="line"></span><br><span class="line"><span class="comment"># Executable</span></span><br><span class="line"></span><br><span class="line">pmemd.cuda -O -i md-restart.in -o md-2.out -p dip.top -c md-1.rst -r md-2.rst -x md-2.nc -AllowSmallBox</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="要求交互式的gpu"><a href="#要求交互式的gpu" class="headerlink" title="要求交互式的gpu"></a>要求交互式的gpu</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">module load gcc/8.2.0 openmpi/4.0.3</span><br><span class="line">module load amber/22</span><br><span class="line"></span><br><span class="line">crc-interactive.py -g -t 12 -n 1 -c 1 -p gtx1080</span><br><span class="line">crc-interactive.py -g -t 12 -n 1 -c 1 -p a100_nvlink</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="进一步对MscL的GaMD"><a href="#进一步对MscL的GaMD" class="headerlink" title="进一步对MscL的GaMD"></a>进一步对MscL的GaMD</h2><p>pdb4amber不好用的时候，去安装目录下跑一下<code>./amber-interactive.py或者./amber.sh</code></p>
<h3 id="蛋白文件准备"><a href="#蛋白文件准备" class="headerlink" title="蛋白文件准备"></a>蛋白文件准备</h3><p><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/540586173">Amber 分子动力学模拟 姜华组祖传MD流程</a></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">pdb4amber -i ref_mscl_LIG_011PC_protein.pdb -o mscl_dry.pdb -p --dry --add-missing-atoms</span><br><span class="line">pdb4amber -i mscl_dry.pdb -o mscl_noH.pdb -y</span><br><span class="line">pdb4amber -i mscl_noH.pdb -o mscl_processed.pdb</span><br><span class="line">reduce mscl_processed.pdb &gt; mscl_h.pdb</span><br><span class="line">tleap </span><br><span class="line">source leaprc.protein.ff19SB</span><br><span class="line">source leaprc.water.tip3p</span><br><span class="line">pro = loadpdb mscl_processed.pdb</span><br></pre></td></tr></table></figure>

<p>注意</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Created a new atom named: OXT within residue: .R&lt;SER 136&gt;</span><br><span class="line">Created a new atom named: OXT within residue: .R&lt;SER 272&gt;</span><br><span class="line">Created a new atom named: OXT within residue: .R&lt;SER 408&gt;</span><br><span class="line">Created a new atom named: OXT within residue: .R&lt;SER 544&gt;</span><br></pre></td></tr></table></figure>

<p> 进一步使用check pdb，报了很多error</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">Checking &#x27;pdb&#x27;....</span><br><span class="line"></span><br><span class="line">Warning: There is a bond of 50.478 angstroms between C and N atoms:</span><br><span class="line">-------  .R&lt;SER 136&gt;.A&lt;C 10&gt; and .R&lt;MET 137&gt;.A&lt;N 1&gt;</span><br><span class="line"></span><br><span class="line">Warning: There is a bond of 54.254 angstroms between C and N atoms:</span><br><span class="line">-------  .R&lt;SER 272&gt;.A&lt;C 10&gt; and .R&lt;MET 273&gt;.A&lt;N 1&gt;</span><br><span class="line"></span><br><span class="line">Warning: There is a bond of 57.792 angstroms between C and N atoms:</span><br><span class="line">-------  .R&lt;SER 408&gt;.A&lt;C 10&gt; and .R&lt;MET 409&gt;.A&lt;N 1&gt;</span><br><span class="line"></span><br><span class="line">Warning: There is a bond of 53.499 angstroms between C and N atoms:</span><br><span class="line">-------  .R&lt;SER 544&gt;.A&lt;C 10&gt; and .R&lt;MET 545&gt;.A&lt;N 1&gt;</span><br><span class="line">FATAL:  Atom .R&lt;SER 136&gt;.A&lt;OXT 12&gt; does not have a type.</span><br><span class="line">FATAL:  Atom .R&lt;SER 272&gt;.A&lt;OXT 12&gt; does not have a type.</span><br><span class="line">FATAL:  Atom .R&lt;SER 408&gt;.A&lt;OXT 12&gt; does not have a type.</span><br><span class="line">FATAL:  Atom .R&lt;SER 544&gt;.A&lt;OXT 12&gt; does not have a type.</span><br><span class="line"></span><br><span class="line">Warning: Close contact of 1.153 angstroms between nonbonded atoms HD22 and HG</span><br><span class="line">-------  .R&lt;ASN 81&gt;.A&lt;HD22 12&gt; and .R&lt;SER 579&gt;.A&lt;HG 9&gt;</span><br><span class="line"></span><br><span class="line">Warning: Close contact of 1.265 angstroms between nonbonded atoms C and OXT</span><br><span class="line">-------  .R&lt;SER 136&gt;.A&lt;C 10&gt; and .R&lt;SER 136&gt;.A&lt;OXT 12&gt;</span><br><span class="line"></span><br><span class="line">Warning: Close contact of 1.265 angstroms between nonbonded atoms C and OXT</span><br><span class="line">-------  .R&lt;SER 272&gt;.A&lt;C 10&gt; and .R&lt;SER 272&gt;.A&lt;OXT 12&gt;</span><br><span class="line"></span><br><span class="line">Warning: Close contact of 1.239 angstroms between nonbonded atoms C and OXT</span><br><span class="line">-------  .R&lt;SER 408&gt;.A&lt;C 10&gt; and .R&lt;SER 408&gt;.A&lt;OXT 12&gt;</span><br><span class="line"></span><br><span class="line">Warning: Close contact of 1.270 angstroms between nonbonded atoms C and OXT</span><br><span class="line">-------  .R&lt;SER 544&gt;.A&lt;C 10&gt; and .R&lt;SER 544&gt;.A&lt;OXT 12&gt;</span><br><span class="line">Checking parameters for unit &#x27;pdb&#x27;.</span><br><span class="line">Checking for bond parameters.</span><br><span class="line">Checking for angle parameters.</span><br><span class="line">check:  Errors:  4   Warnings: 9</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>导出参数进一步检查</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">saveamberparm pro mscl_pro.prmtop mscl_pro.inpcrd</span><br></pre></td></tr></table></figure>

<p>发现就是因为五聚体没加ter，换一个正常的有ter的文件receptor重新跑</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">pdb4amber -i receptor.pdb -o mscl_dry.pdb -p --dry --add-missing-atoms</span><br><span class="line">pdb4amber -i mscl_dry.pdb -o mscl_noH.pdb -y</span><br><span class="line">pdb4amber -i mscl_noH.pdb -o mscl_processed.pdb</span><br><span class="line">reduce mscl_processed.pdb &gt; mscl_h.pdb</span><br><span class="line">tleap </span><br><span class="line"></span><br><span class="line">###mscl_leap.in</span><br><span class="line">source leaprc.protein.ff19SB</span><br><span class="line">source leaprc.water.tip3p</span><br><span class="line">pro = loadpdb mscl_processed.pdb</span><br><span class="line">check pro</span><br><span class="line">solvatebox pro TIP3PBOX 12.0</span><br><span class="line">savepdb pro mscl_solvate.pdb</span><br><span class="line">saveamberparm pro mscl_sol.top mscl_sol.crd</span><br><span class="line">quit</span><br><span class="line"></span><br><span class="line">tleap -f mscl_leap.in</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>1.min.in</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">Minimization</span><br><span class="line">&amp;cntrl</span><br><span class="line"> imin=1,</span><br><span class="line"> irest=0,</span><br><span class="line"> maxcyc=10000,</span><br><span class="line"> ncyc=5000,</span><br><span class="line"> ntpr=100,</span><br><span class="line"> cut=8.0</span><br><span class="line">/</span><br></pre></td></tr></table></figure>

<p>2.heat_NVT.in</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">Heating and NVT</span><br><span class="line">&amp;cntrl</span><br><span class="line"> imin=0, irest=0,</span><br><span class="line"> nstlim=50000, dt=0.002,</span><br><span class="line"> ntp=1, taup=2.0,</span><br><span class="line"> ntb=2,ntc=2,ntf=2,</span><br><span class="line"> ntx=1,cut=8.0,</span><br><span class="line"> ntpr=1000, ntwr=1000, ntwx=1000,</span><br><span class="line"> tempi=0.0, temp0=300, ntt=3, gamma_ln=2.0,</span><br><span class="line">/</span><br><span class="line">&amp;wt TYPE=&#x27;TEMP0&#x27;,ISTEP1=0, ISTEP2=25000,</span><br><span class="line">VALUE1=0.0, VALUE2=300.0, </span><br><span class="line">/</span><br><span class="line">&amp;wt TYPE=&#x27;END&#x27; </span><br><span class="line">/</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sander -O -i 1.min.in -o 1.min.out -p mscl_sol.top -c mscl_sol.c</span><br><span class="line">rst -ref mscl_sol.crd</span><br></pre></td></tr></table></figure>



<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pmemd.cuda -O -i 1.min.in -o 1.min.out -c mscl_sol.crd -p mscl_sol.top -r 1.min.rst -ref mscl_sol.crd</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Warning: When compiling code please add the following flags to nvcc:</span><br><span class="line">         -gencode arch=compute_35,code=[compute_35,sm_35] \</span><br><span class="line">         -gencode arch=compute_61,code=[compute_61,sm_61] </span><br><span class="line">         -gencode arch=compute_70,code=[compute_70,sm_70] </span><br><span class="line">Note: The following floating-point exceptions are signalling: IEEE_UNDERFLOW_FLAG IEEE_DENORMAL</span><br></pre></td></tr></table></figure>



<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pmemd.cuda -O -i 2.heat_NVT.in -o 2.heat_NVT.out -c 1.min.rst -p mscl_sol.top -r 2.heat_NVT.rst -x 2.heat_nvt.crd -inf 02_Heat.mdinfo&amp;</span><br></pre></td></tr></table></figure>



<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">ERROR: Calculation halted.  Periodic box dimensions have changed too much from their initial values.</span><br><span class="line">  Your system density has likely changed by a large amount, probably from</span><br><span class="line">  starting the simulation from a structure a long way from equilibrium.</span><br><span class="line"></span><br><span class="line">  [Although this error can also occur if the simulation has blown up for some reason]</span><br><span class="line"></span><br><span class="line">  The GPU code does not automatically reorganize grid cells and thus you</span><br><span class="line">  will need to restart the calculation from the previous restart file.</span><br><span class="line">  This will generate new grid cells and allow the calculation to continue.</span><br><span class="line">  It may be necessary to repeat this restarting multiple times if your system</span><br><span class="line">  is a long way from an equilibrated density.</span><br><span class="line"></span><br><span class="line">  Alternatively you can run with the CPU code until the density has converged</span><br><span class="line">  and then switch back to the GPU code.</span><br></pre></td></tr></table></figure>

<p>在跑heat的时候报错，怀疑是gpu的问题？于是重新用sander跑了重新跑一下。实际上是自己代码的问题</p>
<h2 id="跑cMD"><a href="#跑cMD" class="headerlink" title="跑cMD"></a>跑cMD</h2><h2 id="跑GaMD"><a href="#跑GaMD" class="headerlink" title="跑GaMD"></a>跑GaMD</h2><p>cMD and GaMD equilibration</p>
<h5 id="1-gamd-equilibration-in"><a href="#1-gamd-equilibration-in" class="headerlink" title="1.gamd.equilibration.in"></a>1.gamd.equilibration.in</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">nstlim = 26000000,</span><br><span class="line">irest = 0,</span><br><span class="line">ntx = 1,</span><br><span class="line"></span><br><span class="line">igamd = 3, iE = 1, irest_gamd = 0,</span><br><span class="line">ntcmd = 1000000, nteb = 25000000, ntave = 200000,</span><br><span class="line">ntcmdprep = 200000, ntebprep = 800000,</span><br><span class="line">sigma0P = 6.0, sigma0D = 6.0,</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pmemd.cuda -O -i 1.gamd.equilibration.in -o 1.gamd.equilibration.out -c mscl_sol.crd -p mscl_sol.top -r 1.gamd.equilibration.rst</span><br></pre></td></tr></table></figure>

<p>指定文件输出轨迹的文件夹，不然ihome爆了会强制停掉</p>
<p>2.production</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">Job #2: start GaMD production simulation</span><br><span class="line"></span><br><span class="line">&amp;cntrl</span><br><span class="line">nstlim = 50000000,</span><br><span class="line">irest = 0,</span><br><span class="line">ntx = 1,</span><br><span class="line"></span><br><span class="line">igamd = 3, iE = 1, irest_gamd = 1,</span><br><span class="line">ntcmd = 0, nteb = 0, ntave = 200000,</span><br><span class="line">ntcmdprep = 0, ntebprep = 0,</span><br><span class="line">sigma0P = 6.0, sigma0D = 6.0,</span><br><span class="line">&amp;end</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pmemd.cuda -O -i 2.gamd.production.in -o 2.gamd.production.out -c 1.gamd.equilibration.rst -p mscl_sol.top -r 2.gamd.production.rst -x 2.gamd.production.crd -inf 2.gamd.production.mdinfo</span><br></pre></td></tr></table></figure>

<p>先找tleap</p>
<p>pymol com找一下ccom bat</p>
<p>cat bat</p>
<p>pymol com_aligned 和 prot是一个文字</p>
<p>使用vi com_aligned</p>
<p>cat complex.pdb UNK删掉complex</p>
<p>close contact, 小于1.5</p>
<p>leap的键删除过于长的见</p>
<h1 id="带有lipid和离子的GaMD"><a href="#带有lipid和离子的GaMD" class="headerlink" title="带有lipid和离子的GaMD"></a>带有lipid和离子的GaMD</h1><p>GaMD&#x3D;1</p>
<h2 id="minimization"><a href="#minimization" class="headerlink" title="minimization"></a>minimization</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pmemd.cuda -O -i 1.gamd.min.in -o 1.gamd.min.out -c prmcrd -p prmtop -r 1.gamd.min.rst -inf 1.gamd.min.mdinfo</span><br></pre></td></tr></table></figure>

<h2 id="heat-amp-NVT"><a href="#heat-amp-NVT" class="headerlink" title="heat &amp; NVT"></a>heat &amp; NVT</h2><p>Error？</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">ERROR: Calculation halted.  Periodic box dimensions have changed too much from their initial values.</span><br><span class="line">  Your system density has likely changed by a large amount, probably from</span><br><span class="line">  starting the simulation from a structure a long way from equilibrium.</span><br><span class="line"></span><br><span class="line">  [Although this error can also occur if the simulation has blown up for some reason]</span><br><span class="line"></span><br><span class="line">  The GPU code does not automatically reorganize grid cells and thus you</span><br><span class="line">  will need to restart the calculation from the previous restart file.</span><br><span class="line">  This will generate new grid cells and allow the calculation to continue.</span><br><span class="line">  It may be necessary to repeat this restarting multiple times if your system</span><br><span class="line">  is a long way from an equilibrated density.</span><br><span class="line"></span><br><span class="line">  Alternatively you can run with the CPU code until the density has converged</span><br><span class="line">  and then switch back to the GPU code.</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>根据<a target="_blank" rel="noopener" href="http://archive.ambermd.org/202006/0200.html">建议</a> modify parameter skinnb<a href="%E5%A2%9E%E5%A4%A7%E5%8F%AF%E4%BB%A5%E5%87%8F%E5%B0%91%E6%8A%A5%E9%94%99%EF%BC%8C%E4%BD%86%E6%9B%B4%E6%98%82%E8%B4%B5">^1</a></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">Heating and NVT</span><br><span class="line">&amp;cntrl</span><br><span class="line"> imin=0, irest=0,</span><br><span class="line"> nstlim=50000, dt=0.002,</span><br><span class="line"> ntp=1, taup=2.0,</span><br><span class="line"> ntb=2,ntc=2,ntf=2,</span><br><span class="line"> ntx=1,cut=8.0,</span><br><span class="line"> ntpr=1000, ntwr=1000, ntwx=1000,</span><br><span class="line"> tempi=0.0, temp0=300, ntt=3, gamma_ln=2.0,</span><br><span class="line">/</span><br><span class="line">&amp;wt TYPE=&#x27;TEMP0&#x27;,ISTEP1=0, ISTEP2=25000,</span><br><span class="line">VALUE1=0.0, VALUE2=300.0,</span><br><span class="line">/</span><br><span class="line">&amp;wt TYPE=&#x27;END&#x27;</span><br><span class="line">/</span><br><span class="line">&amp;ewald</span><br><span class="line"> skinnb=5,</span><br><span class="line">/</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pmemd.cuda -O -i 2.gamd.heat.in -o 2.gamd.heat.out -c 1.gamd.min.rst -p prmtop -r 2.gamd.heat.rst -x 2.gamd.heat.crd -inf 2.gamd.heat.mdinfo</span><br></pre></td></tr></table></figure>

<h2 id="预处理"><a href="#预处理" class="headerlink" title="预处理"></a>预处理</h2><h3 id="第一次加热到100k"><a href="#第一次加热到100k" class="headerlink" title="第一次加热到100k"></a>第一次加热到100k</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pmemd.cuda -O -i 2.1.gamd.heat.in -o 2.1.gamd.heat.out -p prmtop -c 1.gamd.min.rst -r 2.1.gamd.heat.rst -ref 1.gamd.min.rst -x 2.1.gamd.heat.crd -inf 2.1.gamd.heat.mdinfo&amp;</span><br></pre></td></tr></table></figure>

<p>进行GaMD</p>
<p>ntave应该是总原子数的4倍，ntcmd和nteb也都要是ntave的整数倍，体系大约4万原子，设置了20万ntave，够用了</p>
<p>改成了</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pmemd.cuda -O -i 3.gamd.equilibration.in -o 3.gamd.equilibration.out -c 2.gamd.heat.rst -p prmtop -r 3.gamd.equilibration.rst -x 3.gamd.equilibration.crd -inf 3.gamd.equilibration.mdinfo&amp;</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pmemd.cuda -O -i 3.gamd.long.eq.in -o 3.gamd.long.eq.out -c 2.gamd.heat.rst -p prmtop -r 3.gamd.long.eq.rst -x 3.gamd.long.eq.crd -inf 3.gamd.long.eq.mdinfo</span><br></pre></td></tr></table></figure>

<p>报错</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">unsigned long long of length = 42Failed an illegal memory access was encountered</span><br></pre></td></tr></table></figure>

<p>怀疑这里是内存爆了？因为没有写出rst文件（但感觉又不是，因为rst文件就几个M，而轨迹文件才会有几个G）</p>
<h2 id="阅读in文件重写3-eq"><a href="#阅读in文件重写3-eq" class="headerlink" title="阅读in文件重写3.eq"></a>阅读in文件重写3.eq</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/ihome/jwang/feh34/0.tutorial/1.amber_tutorial/2.GaMD/3.v3.long.GaMD_mscl_lipid/3.gamd.long.eq.in</span><br></pre></td></tr></table></figure>

<p>因为crd文件太大了，因此中途转移到、bgfs的2.modified_gamd&#x2F;，随后使用cpptraj的trajin合并.反正也不是很重要</p>
<p>3里忘记设dt&#x3D;0.002和ntf&#x3D;2了，希望影响不大</p>
<h1 id="小脚本"><a href="#小脚本" class="headerlink" title="小脚本"></a>小脚本</h1><p>想获取最后一个输出的序号</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">-rw-r--r-- 1 feh34 jwang 255 Nov 23 11:49 tleap.in</span><br><span class="line">-rw-r--r-- 1 feh34 jwang 9.2M Nov 23 11:49 complex.pdb</span><br><span class="line">-rw-r--r-- 1 feh34 jwang 31M Nov 23 11:49 prmtop</span><br><span class="line">-rw-r--r-- 1 feh34 jwang 4.9M Nov 23 11:49 prmcrd</span><br><span class="line">-rw-r--r-- 1 feh34 jwang 113 Nov 23 11:58 1.gamd.min.in</span><br><span class="line">-rw-r--r-- 1 feh34 jwang 384 Nov 23 11:59 1.gamd.min.mdinfo</span><br><span class="line">-rw-r--r-- 1 feh34 jwang 3.2M Nov 23 11:59 1.gamd.min.rst</span><br><span class="line">-rw-r--r-- 1 feh34 jwang 59K Nov 23 11:59 1.gamd.min.out</span><br><span class="line">-rw-r--r-- 1 feh34 jwang 378 Nov 23 12:50 2.gamd.heat.in</span><br><span class="line">-rw-r--r-- 1 feh34 jwang 556 Nov 23 12:50 2.gamd.heat.mdinfo</span><br><span class="line">-rw-r--r-- 1 feh34 jwang 6.4M Nov 23 12:50 2.gamd.heat.rst</span><br><span class="line">-rw-r--r-- 1 feh34 jwang 77K Nov 23 12:50 2.gamd.heat.out</span><br><span class="line">-rw-r--r-- 1 feh34 jwang 159M Nov 23 12:50 2.gamd.heat.crd</span><br><span class="line">-rw-r--r-- 1 feh34 jwang 260 Nov 23 13:09 3.gamd.equilibration.in</span><br><span class="line">-rw-r--r-- 1 feh34 jwang 65 Nov 23 13:54 look.sh</span><br><span class="line">-rw-r--r-- 1 feh34 jwang 1.1K Nov 23 14:04 3.gamd.equilibration.mdinfo</span><br><span class="line">-rw-r--r-- 1 feh34 jwang 6.4M Nov 23 14:04 3.gamd.equilibration.rst</span><br><span class="line">-rw-r--r-- 1 feh34 jwang 105 Nov 23 14:04 gamd-restart.dat</span><br><span class="line">-rw-r--r-- 1 feh34 jwang 39M Nov 23 14:04 3.gamd.equilibration.out</span><br><span class="line">-rw-r--r-- 1 feh34 jwang 20K Nov 23 14:11 PyReweighting-1D.py</span><br><span class="line">-rw-r--r-- 1 feh34 jwang 19K Nov 23 14:11 PyReweighting-2D.py</span><br><span class="line">-rw-r--r-- 1 feh34 jwang 1.1K Nov 23 15:17 4.gamd.mdinfo</span><br><span class="line">-rw-r--r-- 1 feh34 jwang 6.4M Nov 23 15:18 4.gamd.rst</span><br><span class="line">-rw-r--r-- 1 feh34 jwang 49M Nov 23 15:18 4.gamd.out</span><br><span class="line">-rw-r--r-- 1 feh34 jwang 216 Nov 23 15:23 4.gamd.in</span><br><span class="line">-rw-r--r-- 1 feh34 jwang 216 Nov 23 15:24 5.gamd.in</span><br><span class="line">-rw-r--r-- 1 feh34 jwang 809 Nov 23 15:31 5.v1.after4.longgamd.slurm</span><br><span class="line">-rw-r--r-- 1 feh34 jwang 1.1K Nov 23 16:33 5.gamd.mdinfo</span><br><span class="line">-rw-r--r-- 1 feh34 jwang 6.4M Nov 23 16:34 5.gamd.rst</span><br><span class="line">-rw-r--r-- 1 feh34 jwang 49M Nov 23 16:34 5.gamd.out</span><br><span class="line">-rw-r--r-- 1 feh34 jwang 216 Nov 23 16:45 6.gamd.in</span><br><span class="line">-rw-r--r-- 1 feh34 jwang 1.1K Nov 23 17:53 6.gamd.mdinfo</span><br><span class="line">-rw-r--r-- 1 feh34 jwang 6.4M Nov 23 17:54 6.gamd.rst</span><br><span class="line">-rw-r--r-- 1 feh34 jwang 49M Nov 23 17:54 6.gamd.out</span><br><span class="line">-rw-r--r-- 1 feh34 jwang 218 Nov 23 19:22 7.gamd_double.in</span><br><span class="line">-rw-r--r-- 1 feh34 jwang 53 Nov 23 19:24 gamd.log</span><br><span class="line">-rw-r--r-- 1 feh34 jwang 148 Nov 23 19:27 run</span><br><span class="line">-rw-r--r-- 1 feh34 jwang 1.1K Nov 23 19:41 7.gamd_double.mdinfo</span><br><span class="line">-rw-r--r-- 1 feh34 jwang 13M Nov 23 19:42 7.gamd_double.out</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>则使用</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ll -tlrh | while read rows; do echo $rows; done | tail -n 1 | awk &#x27;&#123;print $9&#125;&#x27;| awk -F. &#x27;&#123;print $1+1&#125;&#x27;</span><br></pre></td></tr></table></figure>

<p>中间这里逐行输出有点脱裤子放屁了</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">old=$(l -tr|tail -n 1|awk &#x27;&#123;print $9&#125;&#x27;|awk -F. &#x27;&#123;print $1&#125;&#x27;)</span><br><span class="line">new=$(($old+1)) #双括号表示运算</span><br><span class="line">cp $old.gamd.double.in $new.gamd.double.in</span><br><span class="line"></span><br></pre></td></tr></table></figure>


    </div>

    
        <hr class="fhr">
        <div id="vcomments"></div>
    
</div>
    <div class="footer" id="footer">
    <p><h4>Copyright © 2020 | Author: Your Name | Theme By <a class="theme-author" target="_blank" rel="noopener" href="https://github.com/Xunzhuo/hexo-theme-coder" style="font-size:14px; color: #969696">Coder</a></h4>
    
        <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
        <span id="busuanzi_container_site_pv">Page Views: <span id="busuanzi_value_site_pv"></span></span>
        <span class="post-meta-divider">|</span>
        <span id="busuanzi_container_site_uv">Unique Visitors: <span id="busuanzi_value_site_uv"></span></span>
    
    <label class="el-switch el-switch-blue el-switch-sm" style="vertical-align: sub;">
        <input type="checkbox" name="switch" id="update_style">
        <span class="el-switch-style"></span>
    </label>

    <!--         <script type="text/javascript">
    var cnzz_protocol = (("https:" == document.location.protocol) ? "https://" : "http://");
    document.write(unescape("%3Cspan id='cnzz_stat_icon_1278548644'%3E%3C/span%3E%3Cscript src='" + cnzz_protocol + "v1.cnzz.com/stat.php%3Fid%3D1278548644%26show%3Dpic1' type='text/javascript'%3E%3C/script%3E"));
    </script> -->
</p>
</div>

<input type="hidden" id="web_style" value="black">
<input type="hidden" id="valine_appid" value="">
<input type="hidden" id="valine_appKey" value="">

<script src="/libs/jquery.min.js"></script>


<script src="/libs/highlight/highlight.pack.js"></script>

<script src='//cdn.jsdelivr.net/npm/valine@1.3.10/dist/Valine.min.js'></script>

<script src="/js/js.js"></script>

<style type="text/css">
.v * {
color: #698fca;
}
.v .vlist .vcard .vhead .vsys {
color: #3a3e4a;
}
.v .vlist .vcard .vh .vmeta .vat {
color: #638fd5;
}
.v .vlist .vcard .vhead .vnick {
color: #6ba1ff;
}
.v a {
color: #8696b1;
}
.v .vlist .vcard .vhead .vnick:hover {
color: #669bfc;
}
</style>
    <script type="text/javascript" color="173,174,173" opacity='1' zIndex="-2" count="99" src="//cdn.bootcss.com/canvas-nest.js/1.0.0/canvas-nest.min.js"></script>
</body>
</html>
